{"ast":null,"code":"import * as React from 'react';\nimport { useEffect, useRef } from 'react';\nimport CacheMap from \"../utils/CacheMap\";\nfunction parseNumber(value) {\n  const num = parseFloat(value);\n  return isNaN(num) ? 0 : num;\n}\nexport default function useHeights(getKey, onItemAdd, onItemRemove) {\n  const [updatedMark, setUpdatedMark] = React.useState(0);\n  const instanceRef = useRef(new Map());\n  const heightsRef = useRef(new CacheMap());\n  const promiseIdRef = useRef(0);\n  function cancelRaf() {\n    promiseIdRef.current += 1;\n  }\n  function collectHeight() {\n    let sync = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n    cancelRaf();\n    const doCollect = () => {\n      let changed = false;\n      instanceRef.current.forEach((element, key) => {\n        if (element && element.offsetParent) {\n          const {\n            offsetHeight\n          } = element;\n          const {\n            marginTop,\n            marginBottom\n          } = getComputedStyle(element);\n          const marginTopNum = parseNumber(marginTop);\n          const marginBottomNum = parseNumber(marginBottom);\n          const totalHeight = offsetHeight + marginTopNum + marginBottomNum;\n          if (heightsRef.current.get(key) !== totalHeight) {\n            heightsRef.current.set(key, totalHeight);\n            changed = true;\n          }\n        }\n      });\n\n      // Always trigger update mark to tell parent that should re-calculate heights when resized\n      if (changed) {\n        setUpdatedMark(c => c + 1);\n      }\n    };\n    if (sync) {\n      doCollect();\n    } else {\n      promiseIdRef.current += 1;\n      const id = promiseIdRef.current;\n      Promise.resolve().then(() => {\n        if (id === promiseIdRef.current) {\n          doCollect();\n        }\n      });\n    }\n  }\n  function setInstanceRef(item, instance) {\n    const key = getKey(item);\n    const origin = instanceRef.current.get(key);\n    if (instance) {\n      instanceRef.current.set(key, instance);\n      collectHeight();\n    } else {\n      instanceRef.current.delete(key);\n    }\n\n    // Instance changed\n    if (!origin !== !instance) {\n      if (instance) {\n        onItemAdd === null || onItemAdd === void 0 || onItemAdd(item);\n      } else {\n        onItemRemove === null || onItemRemove === void 0 || onItemRemove(item);\n      }\n    }\n  }\n  useEffect(() => {\n    return cancelRaf;\n  }, []);\n  return [setInstanceRef, collectHeight, heightsRef.current, updatedMark];\n}","map":{"version":3,"names":["React","useEffect","useRef","CacheMap","parseNumber","value","num","parseFloat","isNaN","useHeights","getKey","onItemAdd","onItemRemove","updatedMark","setUpdatedMark","useState","instanceRef","Map","heightsRef","promiseIdRef","cancelRaf","current","collectHeight","sync","arguments","length","undefined","doCollect","changed","forEach","element","key","offsetParent","offsetHeight","marginTop","marginBottom","getComputedStyle","marginTopNum","marginBottomNum","totalHeight","get","set","c","id","Promise","resolve","then","setInstanceRef","item","instance","origin","delete"],"sources":["/Users/ferncliffadmin/clawd/projects/thesalessherpa/src/client/node_modules/@rc-component/virtual-list/es/hooks/useHeights.js"],"sourcesContent":["import * as React from 'react';\nimport { useEffect, useRef } from 'react';\nimport CacheMap from \"../utils/CacheMap\";\nfunction parseNumber(value) {\n  const num = parseFloat(value);\n  return isNaN(num) ? 0 : num;\n}\nexport default function useHeights(getKey, onItemAdd, onItemRemove) {\n  const [updatedMark, setUpdatedMark] = React.useState(0);\n  const instanceRef = useRef(new Map());\n  const heightsRef = useRef(new CacheMap());\n  const promiseIdRef = useRef(0);\n  function cancelRaf() {\n    promiseIdRef.current += 1;\n  }\n  function collectHeight(sync = false) {\n    cancelRaf();\n    const doCollect = () => {\n      let changed = false;\n      instanceRef.current.forEach((element, key) => {\n        if (element && element.offsetParent) {\n          const {\n            offsetHeight\n          } = element;\n          const {\n            marginTop,\n            marginBottom\n          } = getComputedStyle(element);\n          const marginTopNum = parseNumber(marginTop);\n          const marginBottomNum = parseNumber(marginBottom);\n          const totalHeight = offsetHeight + marginTopNum + marginBottomNum;\n          if (heightsRef.current.get(key) !== totalHeight) {\n            heightsRef.current.set(key, totalHeight);\n            changed = true;\n          }\n        }\n      });\n\n      // Always trigger update mark to tell parent that should re-calculate heights when resized\n      if (changed) {\n        setUpdatedMark(c => c + 1);\n      }\n    };\n    if (sync) {\n      doCollect();\n    } else {\n      promiseIdRef.current += 1;\n      const id = promiseIdRef.current;\n      Promise.resolve().then(() => {\n        if (id === promiseIdRef.current) {\n          doCollect();\n        }\n      });\n    }\n  }\n  function setInstanceRef(item, instance) {\n    const key = getKey(item);\n    const origin = instanceRef.current.get(key);\n    if (instance) {\n      instanceRef.current.set(key, instance);\n      collectHeight();\n    } else {\n      instanceRef.current.delete(key);\n    }\n\n    // Instance changed\n    if (!origin !== !instance) {\n      if (instance) {\n        onItemAdd?.(item);\n      } else {\n        onItemRemove?.(item);\n      }\n    }\n  }\n  useEffect(() => {\n    return cancelRaf;\n  }, []);\n  return [setInstanceRef, collectHeight, heightsRef.current, updatedMark];\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}