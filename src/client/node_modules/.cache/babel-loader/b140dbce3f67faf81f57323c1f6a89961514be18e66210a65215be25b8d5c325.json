{"ast":null,"code":"import _defineProperty from \"/Users/ferncliffadmin/clawd/projects/thesalessherpa/src/client/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport { matchNamePath } from \"../utils/valueUtil\";\n/**\n * Call action with delay in macro task.\n */\nconst macroTask = fn => {\n  const channel = new MessageChannel();\n  channel.port1.onmessage = fn;\n  channel.port2.postMessage(null);\n};\nexport default class WatcherCenter {\n  constructor(form) {\n    _defineProperty(this, \"namePathList\", []);\n    _defineProperty(this, \"taskId\", 0);\n    _defineProperty(this, \"watcherList\", new Set());\n    _defineProperty(this, \"form\", void 0);\n    this.form = form;\n  }\n  register(callback) {\n    this.watcherList.add(callback);\n    return () => {\n      this.watcherList.delete(callback);\n    };\n  }\n  notify(namePath) {\n    // Insert with deduplication\n    namePath.forEach(path => {\n      if (this.namePathList.every(exist => !matchNamePath(exist, path))) {\n        this.namePathList.push(path);\n      }\n    });\n    this.doBatch();\n  }\n  doBatch() {\n    this.taskId += 1;\n    const currentId = this.taskId;\n    macroTask(() => {\n      if (currentId === this.taskId && this.watcherList.size) {\n        const formInst = this.form.getForm();\n        const values = formInst.getFieldsValue();\n        const allValues = formInst.getFieldsValue(true);\n        this.watcherList.forEach(callback => {\n          callback(values, allValues, this.namePathList);\n        });\n        this.namePathList = [];\n      }\n    });\n  }\n}","map":{"version":3,"names":["matchNamePath","macroTask","fn","channel","MessageChannel","port1","onmessage","port2","postMessage","WatcherCenter","constructor","form","_defineProperty","Set","register","callback","watcherList","add","delete","notify","namePath","forEach","path","namePathList","every","exist","push","doBatch","taskId","currentId","size","formInst","getForm","values","getFieldsValue","allValues"],"sources":["/Users/ferncliffadmin/clawd/projects/thesalessherpa/src/client/node_modules/@rc-component/form/es/hooks/useNotifyWatch.js"],"sourcesContent":["import { matchNamePath } from \"../utils/valueUtil\";\n/**\n * Call action with delay in macro task.\n */\nconst macroTask = fn => {\n  const channel = new MessageChannel();\n  channel.port1.onmessage = fn;\n  channel.port2.postMessage(null);\n};\nexport default class WatcherCenter {\n  namePathList = [];\n  taskId = 0;\n  watcherList = new Set();\n  form;\n  constructor(form) {\n    this.form = form;\n  }\n  register(callback) {\n    this.watcherList.add(callback);\n    return () => {\n      this.watcherList.delete(callback);\n    };\n  }\n  notify(namePath) {\n    // Insert with deduplication\n    namePath.forEach(path => {\n      if (this.namePathList.every(exist => !matchNamePath(exist, path))) {\n        this.namePathList.push(path);\n      }\n    });\n    this.doBatch();\n  }\n  doBatch() {\n    this.taskId += 1;\n    const currentId = this.taskId;\n    macroTask(() => {\n      if (currentId === this.taskId && this.watcherList.size) {\n        const formInst = this.form.getForm();\n        const values = formInst.getFieldsValue();\n        const allValues = formInst.getFieldsValue(true);\n        this.watcherList.forEach(callback => {\n          callback(values, allValues, this.namePathList);\n        });\n        this.namePathList = [];\n      }\n    });\n  }\n}"],"mappings":";AAAA,SAASA,aAAa,QAAQ,oBAAoB;AAClD;AACA;AACA;AACA,MAAMC,SAAS,GAAGC,EAAE,IAAI;EACtB,MAAMC,OAAO,GAAG,IAAIC,cAAc,CAAC,CAAC;EACpCD,OAAO,CAACE,KAAK,CAACC,SAAS,GAAGJ,EAAE;EAC5BC,OAAO,CAACI,KAAK,CAACC,WAAW,CAAC,IAAI,CAAC;AACjC,CAAC;AACD,eAAe,MAAMC,aAAa,CAAC;EAKjCC,WAAWA,CAACC,IAAI,EAAE;IAAAC,eAAA,uBAJH,EAAE;IAAAA,eAAA,iBACR,CAAC;IAAAA,eAAA,sBACI,IAAIC,GAAG,CAAC,CAAC;IAAAD,eAAA;IAGrB,IAAI,CAACD,IAAI,GAAGA,IAAI;EAClB;EACAG,QAAQA,CAACC,QAAQ,EAAE;IACjB,IAAI,CAACC,WAAW,CAACC,GAAG,CAACF,QAAQ,CAAC;IAC9B,OAAO,MAAM;MACX,IAAI,CAACC,WAAW,CAACE,MAAM,CAACH,QAAQ,CAAC;IACnC,CAAC;EACH;EACAI,MAAMA,CAACC,QAAQ,EAAE;IACf;IACAA,QAAQ,CAACC,OAAO,CAACC,IAAI,IAAI;MACvB,IAAI,IAAI,CAACC,YAAY,CAACC,KAAK,CAACC,KAAK,IAAI,CAACzB,aAAa,CAACyB,KAAK,EAAEH,IAAI,CAAC,CAAC,EAAE;QACjE,IAAI,CAACC,YAAY,CAACG,IAAI,CAACJ,IAAI,CAAC;MAC9B;IACF,CAAC,CAAC;IACF,IAAI,CAACK,OAAO,CAAC,CAAC;EAChB;EACAA,OAAOA,CAAA,EAAG;IACR,IAAI,CAACC,MAAM,IAAI,CAAC;IAChB,MAAMC,SAAS,GAAG,IAAI,CAACD,MAAM;IAC7B3B,SAAS,CAAC,MAAM;MACd,IAAI4B,SAAS,KAAK,IAAI,CAACD,MAAM,IAAI,IAAI,CAACZ,WAAW,CAACc,IAAI,EAAE;QACtD,MAAMC,QAAQ,GAAG,IAAI,CAACpB,IAAI,CAACqB,OAAO,CAAC,CAAC;QACpC,MAAMC,MAAM,GAAGF,QAAQ,CAACG,cAAc,CAAC,CAAC;QACxC,MAAMC,SAAS,GAAGJ,QAAQ,CAACG,cAAc,CAAC,IAAI,CAAC;QAC/C,IAAI,CAAClB,WAAW,CAACK,OAAO,CAACN,QAAQ,IAAI;UACnCA,QAAQ,CAACkB,MAAM,EAAEE,SAAS,EAAE,IAAI,CAACZ,YAAY,CAAC;QAChD,CAAC,CAAC;QACF,IAAI,CAACA,YAAY,GAAG,EAAE;MACxB;IACF,CAAC,CAAC;EACJ;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}